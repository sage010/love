<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>致 邓琳钰</title>
    <style>
        /* --- 页面基础样式：解决浏览器打开无法显示问题 (问题 2) --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #050002;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: "Noto Serif SC", "SimSun", serif;
            touch-action: manipulation; /* 优化移动端触摸响应 */
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            filter: contrast(1.2) brightness(1.1);
        }

        /* --- 中间文字 --- */
        .center-box {
            position: relative;
            z-index: 10;
            text-align: center;
            mix-blend-mode: screen;
        }

        .name {
            font-size: 4.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffe6e6 0%, #ff9a9e 50%, #ff6b81 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 10px;
            text-shadow: 0 0 30px rgba(255, 107, 129, 0.6);
            animation: textBreath 3s ease-in-out infinite;
        }

        .subtitle {
            margin-top: 15px;
            font-family: "Arial", sans-serif;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            letter-spacing: 6px;
            text-transform: uppercase;
        }

        /* --- 提示点击 (问题 4) --- */
        .click-hint {
            position: absolute;
            bottom: 50px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 14px;
            z-index: 20;
            letter-spacing: 2px;
            animation: hintPulse 2s infinite;
            pointer-events: none; /* 确保点击能穿透文字，被 body 捕获 */
        }

        @keyframes textBreath {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(255, 107, 129, 0.3)); }
            50% { transform: scale(1.03); filter: drop-shadow(0 0 25px rgba(255, 107, 129, 0.6)); }
        }

        @keyframes hintPulse {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 0.8; }
        }

        @media (max-width: 768px) {
            .name { font-size: 2.8rem; letter-spacing: 5px; }
        }
    </style>
</head>
<body>

    <canvas id="canvas"></canvas>
    
    <div class="center-box">
        <div class="name">邓琳钰</div>
        <div class="subtitle">MY UNIVERSE</div> 
    </div>

    <div class="click-hint" id="hint">点击或触屏 · 开启惊喜</div>

    <audio id="bgm" loop>
        <source src="dly.mp3" type="audio/mpeg">
    </audio>

    <script>
        // --- 1. 音乐控制逻辑 (iOS/微信/点击触发修复 - 问题 1 & 4) ---
        const audio = document.getElementById('bgm');
        const hint = document.getElementById('hint');
        let isPlayed = false; 

        function tryPlayMusic() {
            if (isPlayed) return;

            // 尝试播放，并捕获 Promise 错误，这是 iOS 关键修复
            const playPromise = audio.play();

            if (playPromise !== undefined) {
                playPromise.then(() => {
                    // 播放成功
                    hint.style.display = 'none';
                    isPlayed = true;
                }).catch(error => {
                    // 播放被拦截，等待下一次交互
                    console.log("播放被拦截，等待下次用户交互。");
                });
            }
        }
        
        // 绑定事件：同时使用 touchstart 和 click (问题 4)
        // 使用 {once: true} 确保只触发一次
        document.body.addEventListener('touchstart', tryPlayMusic, {once: true});
        document.body.addEventListener('click', tryPlayMusic, {once: true});

        // 微信专用修复代码
        document.addEventListener("WeixinJSBridgeReady", function () {
            tryPlayMusic();
        }, false);


        // --- 2. 爱心粒子特效逻辑 ---
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        // 声明动态缩放比例
        let heartScale = 15; 
        
        let particles = [];
        const particleCount = 1200; 
        const colors = ['#ff9a9e', '#fecfef', '#ff6b81', '#fcb69f', '#ffdde1'];

        // 核心：动态调整画布和缩放比例 (问题 3)
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            
            // 确保爱心在任何屏幕上都完整显示，取屏幕最小尺寸的 8% 作为缩放基准
            const baseSize = 0.08; 
            heartScale = Math.min(width, height) * baseSize;
        }
        window.addEventListener('resize', resize);
        resize();

        // 使用动态缩放比例
        function getHeartPoint(t) {
            const x = 16 * Math.pow(Math.sin(t), 3);
            const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
            // 这里使用全局的 heartScale
            return { x: x * heartScale, y: -y * heartScale };
        }

        class Particle {
            constructor() { this.reset(true); }
            reset(isInit = false) {
                const t = Math.random() * 2 * Math.PI;
                const heart = getHeartPoint(t);
                const centerX = width / 2;
                const centerY = height / 2;
                this.targetX = centerX + heart.x;
                this.targetY = centerY + heart.y;
                if (isInit) {
                    this.x = Math.random() * width;
                    this.y = Math.random() * height;
                } else {
                    this.x = centerX;
                    this.y = centerY;
                }
                this.size = Math.random() * 2.5;
                this.speed = Math.random() * 0.06 + 0.02;
                this.color = colors[Math.floor(Math.random() * colors.length)];
                this.offsetX = (Math.random() - 0.5) * 20; 
                this.offsetY = (Math.random() - 0.5) * 20; 
            }
            update(beatScale, time) {
                const centerX = width / 2;
                const centerY = height / 2;
                let targetX = centerX + (this.targetX - centerX) * beatScale + this.offsetX;
                let targetY = centerY + (this.targetY - centerY) * beatScale + this.offsetY;
                targetX += Math.sin(time * 2 + this.size) * 5;
                targetY += Math.cos(time * 2 + this.size) * 5;
                this.x += (targetX - this.x) * this.speed;
                this.y += (targetY - this.y) * this.speed;
                this.draw();
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            for (let i = 0; i < particleCount; i++) { particles.push(new Particle()); }
        }

        function animate() {
            // 拖尾效果
            ctx.fillStyle = 'rgba(5, 0, 2, 0.15)'; 
            ctx.fillRect(0, 0, width, height);
            const time = Date.now() / 1000;
            let beat = Math.sin(time * 3); 
            let beatScale = 1 + Math.pow(Math.abs(beat), 4) * 0.12;
            particles.forEach(p => p.update(beatScale, time));
            requestAnimationFrame(animate);
        }

        initParticles();
        animate();
    </script>
</body>
</html>
